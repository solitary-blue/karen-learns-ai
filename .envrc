# Karen's AI Learning Environment
# Inherit from parent directories (uses source_up_if_exists to avoid
# errors if no parent .envrc is found)
source_up_if_exists

export KAREN_NAME="Karen Ngo"
export KAREN_EMAIL="solitary_blue@hotmail.com"
export KAREN_GITHUB_HANDLE="solitary-blue"

# GUIDE details
export GUIDE_FULL_NAME="Michael Johnston"
export GUIDE_HANDLE="lastobelus"
export GUIDE_EMAIL="lastobelus@mac.com"

# Git Identity
# These ensure that commits made in this directory are attributed to Karen.
export GIT_AUTHOR_NAME="$KAREN_NAME"
export GIT_AUTHOR_EMAIL="$KAREN_EMAIL"
export GIT_COMMITTER_NAME="$KAREN_NAME"
export GIT_COMMITTER_EMAIL="$KAREN_EMAIL"

# GitHub CLI (gh)
# This token will allow 'gh' commands to run as Karen.
# export GH_TOKEN="your_karen_github_token_here"

# Path to local agent skills
export AGENT_SKILLS_PATH="./.agents/skills"

# SOPS Key Location
export SOPS_AGE_KEY_FILE="$HOME/.config/sops/age/keys.txt"

# Automatic Secrets Decryption
if [ -f "secrets.enc.env" ] && command -v sops &>/dev/null; then
    # Tell direnv to watch the secrets file for changes
    watch_file secrets.enc.env
    
    # Decrypt to a temporary string first, then eval only if it succeeded
    _secrets=$(sops decrypt --output-type dotenv secrets.enc.env 2>/dev/null | grep -E '^[A-Za-z_][A-Za-z0-9_]*=' | sed 's/^/export /')
    if [ -n "$_secrets" ]; then
        eval "$_secrets"
        # Map Karen's token to the standard GH_TOKEN for CLI use
        export GH_TOKEN="$KAREN_GH_TOKEN"
    fi
    unset _secrets
fi
